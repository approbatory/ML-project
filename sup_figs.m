%either used or unused supplementary figures

%unused: effect of cutoff velocity on amount of
%trials declared:

while true
    sessions_all = {...
        '../linear_track/Mouse2025/Mouse-2025-20150307-linear-track/Mouse-2025-20150307_104428-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2025/Mouse-2025-20150228-linear-track/Mouse-2025-20150228_160317-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2025/Mouse-2025-20150321-linear-track/Mouse-2025-20150321_134149-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2025/Mouse-2025-20150323-linear-track/Mouse-2025-20150323_090111-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2025/Mouse-2025-20150325-linear-track/Mouse-2025-20150325_131626-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2025/Mouse-2025-20150303-linear-track/Mouse-2025-20150303_091715-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2025/Mouse-2025-20150305-linear-track/Mouse-2025-20150305_112222-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2025/Mouse-2025-20150317-linear-track/Mouse-2025-20150317_090833-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2025/Mouse-2025-20150327-linear-track/Mouse-2025-20150327_094347-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2025/Mouse-2025-20150301-linear-track/Mouse-2025-20150301_130341-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2025/Mouse-2025-20150301-linear-track/Mouse-2025-20150301_181458-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2025/Mouse-2025-20150329-linear-track/Mouse-2025-20150329_111804-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2025/Mouse-2025-20150319-linear-track/Mouse-2025-20150319_090510-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2025/Mouse-2025-20150319-linear-track/Mouse-2025-20150319_095211-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2025/Mouse-2025-20150331-linear-track/Mouse-2025-20150331_082446-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2025/Mouse-2025-20150313-linear-track/Mouse-2025-20150313_103035-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2025/Mouse-2025-20150315-linear-track/Mouse-2025-20150315_094432-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2025/Mouse-2025-20150309-linear-track/Mouse-2025-20150309_095611-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2025/Mouse-2025-20150311-linear-track/Mouse-2025-20150311_081758-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2012/Mouse-2012-20150126-linear-track/Mouse-2012-20150126_083013-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2012/Mouse-2012-20150209-linear-track/Mouse-2012-20150209_084856-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2012/Mouse-2012-20141203-linear-track/Mouse-2012-20141203_084234-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2012/Mouse-2012-20150202-linear-track/Mouse-2012-20150202_085844-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2012/Mouse-2012-20141219-linear-track/Mouse-2012-20141219_094111-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2012/Mouse-2012-20141129-linear-track/Mouse-2012-20141129_100639-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2012/Mouse-2012-20150118-linear-track/Mouse-2012-20150118_100831-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2012/Mouse-2012-20150118-linear-track/Mouse-2012-20150118_122056-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2012/Mouse-2012-20150212-linear-track/Mouse-2012-20150212_082737-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2012/Mouse-2012-20150205-linear-track/Mouse-2012-20150205_090558-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2012/Mouse-2012-20141209-linear-track/Mouse-2012-20141209_082401-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2012/Mouse-2012-20141213-linear-track/Mouse-2012-20141213_100118-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2012/Mouse-2012-20150130-linear-track/Mouse-2012-20150130_102501-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2012/Mouse-2012-20150203-linear-track/Mouse-2012-20150203_091636-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2012/Mouse-2012-20141221-linear-track/Mouse-2012-20141221_095806-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2012/Mouse-2012-20150211-linear-track/Mouse-2012-20150211_151241-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2012/Mouse-2012-20141207-linear-track/Mouse-2012-20141207_100218-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2012/Mouse-2012-20141126-linear-track/Mouse-2012-20141126_085441-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2012/Mouse-2012-20141205-linear-track/Mouse-2012-20141205_083324-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2012/Mouse-2012-20150120-linear-track/Mouse-2012-20150120_083419-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2012/Mouse-2012-20141123-linear-track/Mouse-2012-20141123_000520-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2012/Mouse-2012-20150116-linear-track/Mouse-2012-20150116_101239-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2012/Mouse-2012-20150124-linear-track/Mouse-2012-20150124_100435-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2012/Mouse-2012-20150207-linear-track/Mouse-2012-20150207_102450-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2012/Mouse-2012-20150207-linear-track/Mouse-2012-20150207_134254-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2012/Mouse-2012-20141223-linear-track/Mouse-2012-20141223_082741-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2012/Mouse-2012-20150122-linear-track/Mouse-2012-20150122_082416-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2012/Mouse-2012-20141127-linear-track/Mouse-2012-20141127_101659-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2012/Mouse-2012-20150128-linear-track/Mouse-2012-20150128_100143-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2012/Mouse-2012-20150128-linear-track/Mouse-2012-20150128_171615-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2012/Mouse-2012-20150114-linear-track/Mouse-2012-20150114_140933-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2012/Mouse-2012-20150112-linear-track/Mouse-2012-20150112_085723-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2012/Mouse-2012-20141211-linear-track/Mouse-2012-20141211_121707-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2012/Mouse-2012-20150123-linear-track/Mouse-2012-20150123_135330-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2012/Mouse-2012-20150201-linear-track/Mouse-2012-20150201_095905-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2012/Mouse-2012-20150113-linear-track/Mouse-2012-20150113_141832-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2012/Mouse-2012-20141217-linear-track/Mouse-2012-20141217_104915-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2012/Mouse-2012-20141125-linear-track/Mouse-2012-20141125_215941-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2012/Mouse-2012-20141125-linear-track/Mouse-2012-20141125_030700-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2012/Mouse-2012-20141215-linear-track/Mouse-2012-20141215_110325-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2012/Mouse-2012-20141201-linear-track/Mouse-2012-20141201_083556-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2010/Mouse-2010-20150205-linear-track/Mouse-2010-20150205_102524-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2010/Mouse-2010-20141128-linear-track/Mouse-2010-20141128_121404-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2010/Mouse-2010-20150202-linear-track/Mouse-2010-20150202_101928-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2010/Mouse-2010-20141207-linear-track/Mouse-2010-20141207_115722-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2010/Mouse-2010-20141219-linear-track/Mouse-2010-20141219_105955-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2010/Mouse-2010-20150116-linear-track/Mouse-2010-20150116_113236-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2010/Mouse-2010-20150114-linear-track/Mouse-2010-20150114_152716-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2010/Mouse-2010-20141213-linear-track/Mouse-2010-20141213_115553-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2010/Mouse-2010-20150118-linear-track/Mouse-2010-20150118_134034-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2010/Mouse-2010-20150118-linear-track/Mouse-2010-20150118_112236-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2010/Mouse-2010-20150207-linear-track/Mouse-2010-20150207_114314-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2010/Mouse-2010-20150130-linear-track/Mouse-2010-20150130_094711-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2010/Mouse-2010-20141209-linear-track/Mouse-2010-20141209_101632-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2010/Mouse-2010-20150126-linear-track/Mouse-2010-20150126_094735-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2010/Mouse-2010-20141202-linear-track/Mouse-2010-20141202_110542-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2010/Mouse-2010-20141223-linear-track/Mouse-2010-20141223_094533-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2010/Mouse-2010-20150120-linear-track/Mouse-2010-20150120_095710-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2010/Mouse-2010-20150113-linear-track/Mouse-2010-20150113_160417-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2010/Mouse-2010-20141221-linear-track/Mouse-2010-20141221_113118&115136-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2010/Mouse-2010-20141126-linear-track/Mouse-2010-20141126_151543-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2010/Mouse-2010-20141126-linear-track/Mouse-2010-20141126_111415-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2010/Mouse-2010-20150122-linear-track/Mouse-2010-20150122_093836-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2010/Mouse-2010-20141125-linear-track/Mouse-2010-20141125_000156-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2010/Mouse-2010-20150123-linear-track/Mouse-2010-20150123_150954-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2010/Mouse-2010-20150212-linear-track/Mouse-2010-20150212_094703-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2010/Mouse-2010-20150203-linear-track/Mouse-2010-20150203_103253-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2010/Mouse-2010-20150201-linear-track/Mouse-2010-20150201_111454-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2010/Mouse-2010-20141211-linear-track/Mouse-2010-20141211_140916-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2010/Mouse-2010-20150211-linear-track/Mouse-2010-20150211_160238-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2010/Mouse-2010-20141205-linear-track/Mouse-2010-20141205_102648-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2010/Mouse-2010-20150112-linear-track/Mouse-2010-20150112_103135-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2010/Mouse-2010-20141130-linear-track/Mouse-2010-20141130_115330-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2010/Mouse-2010-20150209-linear-track/Mouse-2010-20150209_100711-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2010/Mouse-2010-20141203-linear-track/Mouse-2010-20141203_103645-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2010/Mouse-2010-20141215-linear-track/Mouse-2010-20141215_125115-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2010/Mouse-2010-20150124-linear-track/Mouse-2010-20150124_111828-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2010/Mouse-2010-20141217-linear-track/Mouse-2010-20141217_120259-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2010/Mouse-2010-20150128-linear-track/Mouse-2010-20150128_111752-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2028/Mouse-2028-20150317-linear-track/Mouse-2028-20150317_102240-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2028/Mouse-2028-20150325-linear-track/Mouse-2028-20150325_143248-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2028/Mouse-2028-20150303-linear-track/Mouse-2028-20150303_103622-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2028/Mouse-2028-20150305-linear-track/Mouse-2028-20150305_132231-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2028/Mouse-2028-20150311-linear-track/Mouse-2028-20150311_093214-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2028/Mouse-2028-20150313-linear-track/Mouse-2028-20150313_114415-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2028/Mouse-2028-20150319-linear-track/Mouse-2028-20150319_105610-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2028/Mouse-2028-20150323-linear-track/Mouse-2028-20150323_105955-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2028/Mouse-2028-20150329-linear-track/Mouse-2028-20150329_133137-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2028/Mouse-2028-20150307-linear-track/Mouse-2028-20150307_120240-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2028/Mouse-2028-20150309-linear-track/Mouse-2028-20150309_110935-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2028/Mouse-2028-20150321-linear-track/Mouse-2028-20150321_144549-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2028/Mouse-2028-20150301-linear-track/Mouse-2028-20150301_141039-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2028/Mouse-2028-20150301-linear-track/Mouse-2028-20150301_192709-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2028/Mouse-2028-20150228-linear-track/Mouse-2028-20150228_114834-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2028/Mouse-2028-20150228-linear-track/Mouse-2028-20150228_172215-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2028/Mouse-2028-20150327-linear-track/Mouse-2028-20150327_105544-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2028/Mouse-2028-20150315-linear-track/Mouse-2028-20150315_105814-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2019/Mouse-2019-20150301-linear-track/Mouse-2019-20150301_104001-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2019/Mouse-2019-20150301-linear-track/Mouse-2019-20150301_143437-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2019/Mouse-2019-20150311-linear-track/Mouse-2019-20150311_101049-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2019/Mouse-2019-20150321-linear-track/Mouse-2019-20150321_095525-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2019/Mouse-2019-20150228-linear-track/Mouse-2019-20150228_130909-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2019/Mouse-2019-20150228-linear-track/Mouse-2019-20150228_174527-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2019/Mouse-2019-20150326-linear-track/Mouse-2019-20150326_081710-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2019/Mouse-2019-20150306-linear-track/Mouse-2019-20150306_093422-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2019/Mouse-2019-20150331-linear-track/Mouse-2019-20150331_125138-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2019/Mouse-2019-20150316-linear-track/Mouse-2019-20150316_072301-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2011/Mouse-2011-20150130-linear-track/Mouse-2011-20150130_091036-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2011/Mouse-2011-20141209-linear-track/Mouse-2011-20141209_090137-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2011/Mouse-2011-20141223-linear-track/Mouse-2011-20141223_090517-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2011/Mouse-2011-20150116-linear-track/Mouse-2011-20150116_105412-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2011/Mouse-2011-20141211-linear-track/Mouse-2011-20141211_125424-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2011/Mouse-2011-20150112-linear-track/Mouse-2011-20150112_094026-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2011/Mouse-2011-20150124-linear-track/Mouse-2011-20150124_104148-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2011/Mouse-2011-20141201-linear-track/Mouse-2011-20141201_091423-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2011/Mouse-2011-20141126-linear-track/Mouse-2011-20141126_142057-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2011/Mouse-2011-20141126-linear-track/Mouse-2011-20141126_102932-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2011/Mouse-2011-20141127-linear-track/Mouse-2011-20141127_105556-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2011/Mouse-2011-20141125-linear-track/Mouse-2011-20141125_223115-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2011/Mouse-2011-20141125-linear-track/Mouse-2011-20141125_033559-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2011/Mouse-2011-20141217-linear-track/Mouse-2011-20141217_112712-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2011/Mouse-2011-20150122-linear-track/Mouse-2011-20150122_090159-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2011/Mouse-2011-20150128-linear-track/Mouse-2011-20150128_175300-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2011/Mouse-2011-20150128-linear-track/Mouse-2011-20150128_103926-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2011/Mouse-2011-20141129-linear-track/Mouse-2011-20141129_104511-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2011/Mouse-2011-20141123-linear-track/Mouse-2011-20141123_003522-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2011/Mouse-2011-20141203-linear-track/Mouse-2011-20141203_092044-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2011/Mouse-2011-20141221-linear-track/Mouse-2011-20141221_103622-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2011/Mouse-2011-20150205-linear-track/Mouse-2011-20150205_094701-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2011/Mouse-2011-20150207-linear-track/Mouse-2011-20150207_110324-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2011/Mouse-2011-20150207-linear-track/Mouse-2011-20150207_142436-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2011/Mouse-2011-20150209-linear-track/Mouse-2011-20150209_092502-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2011/Mouse-2011-20141213-linear-track/Mouse-2011-20141213_104253-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2011/Mouse-2011-20141207-linear-track/Mouse-2011-20141207_104116-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2011/Mouse-2011-20150113-linear-track/Mouse-2011-20150113_150037-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2011/Mouse-2011-20150203-linear-track/Mouse-2011-20150203_095456-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2011/Mouse-2011-20150120-linear-track/Mouse-2011-20150120_091222-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2011/Mouse-2011-20150126-linear-track/Mouse-2011-20150126_091016-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2011/Mouse-2011-20141219-linear-track/Mouse-2011-20141219_102235-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2011/Mouse-2011-20150118-linear-track/Mouse-2011-20150118_104559-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2011/Mouse-2011-20141215-linear-track/Mouse-2011-20141215_113956-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2011/Mouse-2011-20150212-linear-track/Mouse-2011-20150212_090836-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2011/Mouse-2011-20150211-linear-track/Mouse-2011-20150211_163711-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2029/Mouse-2029-20150306-linear-track/Mouse-2029-20150306_121634-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2029/Mouse-2029-20150321-linear-track/Mouse-2029-20150321_122709-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2029/Mouse-2029-20150228-linear-track/Mouse-2029-20150228_150949-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2029/Mouse-2029-20150228-linear-track/Mouse-2029-20150228_120509-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2029/Mouse-2029-20150331-linear-track/Mouse-2029-20150331_152034-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2029/Mouse-2029-20150326-linear-track/Mouse-2029-20150326_105003-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2029/Mouse-2029-20150316-linear-track/Mouse-2029-20150316_094956-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2029/Mouse-2029-20150311-linear-track/Mouse-2029-20150311_131945-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2029/Mouse-2029-20150301-linear-track/Mouse-2029-20150301_121435-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2029/Mouse-2029-20150301-linear-track/Mouse-2029-20150301_165938-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2024/Mouse-2024-20150321-linear-track/Mouse-2024-20150321_130536&130559-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2024/Mouse-2024-20150311-linear-track/Mouse-2024-20150311_073912-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2024/Mouse-2024-20150305-linear-track/Mouse-2024-20150305_104454-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2024/Mouse-2024-20150329-linear-track/Mouse-2024-20150329_104048-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2024/Mouse-2024-20150228-linear-track/Mouse-2024-20150228_153237-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2024/Mouse-2024-20150313-linear-track/Mouse-2024-20150313_095203-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2024/Mouse-2024-20150301-linear-track/Mouse-2024-20150301_173817-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2024/Mouse-2024-20150301-linear-track/Mouse-2024-20150301_124134-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2024/Mouse-2024-20150317-linear-track/Mouse-2024-20150317_202708-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2024/Mouse-2024-20150315-linear-track/Mouse-2024-20150315_090450-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2024/Mouse-2024-20150323-linear-track/Mouse-2024-20150323_082351-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2024/Mouse-2024-20150325-linear-track/Mouse-2024-20150325_114324-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2024/Mouse-2024-20150331-linear-track/Mouse-2024-20150331_101607-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2024/Mouse-2024-20150319-linear-track/Mouse-2024-20150319_082641-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2024/Mouse-2024-20150309-linear-track/Mouse-2024-20150309_090858&091446-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2024/Mouse-2024-20150327-linear-track/Mouse-2024-20150327_090539-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2024/Mouse-2024-20150303-linear-track/Mouse-2024-20150303_082851-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2024/Mouse-2024-20150307-linear-track/Mouse-2024-20150307_100459-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2021/Mouse-2021-20150311-linear-track/Mouse-2021-20150311_104705-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2021/Mouse-2021-20150306-linear-track/Mouse-2021-20150306_101057-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2021/Mouse-2021-20150316-linear-track/Mouse-2021-20150316_075956-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2021/Mouse-2021-20150228-linear-track/Mouse-2021-20150228_180537-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2021/Mouse-2021-20150331-linear-track/Mouse-2021-20150331_132808-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2021/Mouse-2021-20150301-linear-track/Mouse-2021-20150301_151117-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2021/Mouse-2021-20150301-linear-track/Mouse-2021-20150301_110509-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2021/Mouse-2021-20150326-linear-track/Mouse-2021-20150326_085536-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2023/Mouse-2023-20150311-linear-track/Mouse-2023-20150311_124240-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2023/Mouse-2023-20150321-linear-track/Mouse-2023-20150321_114832-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2023/Mouse-2023-20150331-linear-track/Mouse-2023-20150331_144419-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2023/Mouse-2023-20150301-linear-track/Mouse-2023-20150301_114752-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2023/Mouse-2023-20150301-linear-track/Mouse-2023-20150301_162349-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2023/Mouse-2023-20150228-linear-track/Mouse-2023-20150228_144258-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2023/Mouse-2023-20150228-linear-track/Mouse-2023-20150228_185044-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2023/Mouse-2023-20150306-linear-track/Mouse-2023-20150306_112849-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2023/Mouse-2023-20150326-linear-track/Mouse-2023-20150326_101329-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2023/Mouse-2023-20150316-linear-track/Mouse-2023-20150316_091246-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2022/Mouse-2022-20150316-linear-track/Mouse-2022-20150316_083627-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2022/Mouse-2022-20150306-linear-track/Mouse-2022-20150306_104914-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2022/Mouse-2022-20150227-linear-track/Mouse-2022-20150227_182234-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2022/Mouse-2022-20150228-linear-track/Mouse-2022-20150228_182558-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2022/Mouse-2022-20150228-linear-track/Mouse-2022-20150228_142050-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2022/Mouse-2022-20150321-linear-track/Mouse-2022-20150321_111200-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2022/Mouse-2022-20150331-linear-track/Mouse-2022-20150331_140317-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2022/Mouse-2022-20150311-linear-track/Mouse-2022-20150311_112532-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2022/Mouse-2022-20150329-linear-track/Mouse-2022-20150329_100439-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2022/Mouse-2022-20150326-linear-track/Mouse-2022-20150326_093722-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2022/Mouse-2022-20150301-linear-track/Mouse-2022-20150301_112611-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2022/Mouse-2022-20150301-linear-track/Mouse-2022-20150301_154837-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2022/Mouse-2022-20150327-linear-track/Mouse-2022-20150327_082741-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2026/Mouse-2026-20150307-linear-track/Mouse-2026-20150307_112614-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2026/Mouse-2026-20150331-linear-track/Mouse-2026-20150331_090237-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2026/Mouse-2026-20150323-linear-track/Mouse-2026-20150323_102333-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2026/Mouse-2026-20150327-linear-track/Mouse-2026-20150327_101915-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2026/Mouse-2026-20150329-linear-track/Mouse-2026-20150329_115639-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2026/Mouse-2026-20150319-linear-track/Mouse-2026-20150319_101913-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2026/Mouse-2026-20150325-linear-track/Mouse-2026-20150325_135422-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2026/Mouse-2026-20150305-linear-track/Mouse-2026-20150305_115921-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2026/Mouse-2026-20150311-linear-track/Mouse-2026-20150311_085602-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2026/Mouse-2026-20150303-linear-track/Mouse-2026-20150303_095846-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2026/Mouse-2026-20150309-linear-track/Mouse-2026-20150309_103302-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2026/Mouse-2026-20150315-linear-track/Mouse-2026-20150315_102127-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2026/Mouse-2026-20150321-linear-track/Mouse-2026-20150321_141554-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2026/Mouse-2026-20150313-linear-track/Mouse-2026-20150313_110801-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2026/Mouse-2026-20150301-linear-track/Mouse-2026-20150301_132603-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2026/Mouse-2026-20150301-linear-track/Mouse-2026-20150301_185053-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2026/Mouse-2026-20150228-linear-track/Mouse-2026-20150228_110319-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2026/Mouse-2026-20150228-linear-track/Mouse-2026-20150228_162802-linear-track-TracesAndEvents.mat',...
        '../linear_track/Mouse2026/Mouse-2026-20150317-linear-track/Mouse-2026-20150317_094553-linear-track-TracesAndEvents.mat'};
    session_mouse_all = {...
        'Mouse2025',...
        'Mouse2025',...
        'Mouse2025',...
        'Mouse2025',...
        'Mouse2025',...
        'Mouse2025',...
        'Mouse2025',...
        'Mouse2025',...
        'Mouse2025',...
        'Mouse2025',...
        'Mouse2025',...
        'Mouse2025',...
        'Mouse2025',...
        'Mouse2025',...
        'Mouse2025',...
        'Mouse2025',...
        'Mouse2025',...
        'Mouse2025',...
        'Mouse2025',...
        'Mouse2012',...
        'Mouse2012',...
        'Mouse2012',...
        'Mouse2012',...
        'Mouse2012',...
        'Mouse2012',...
        'Mouse2012',...
        'Mouse2012',...
        'Mouse2012',...
        'Mouse2012',...
        'Mouse2012',...
        'Mouse2012',...
        'Mouse2012',...
        'Mouse2012',...
        'Mouse2012',...
        'Mouse2012',...
        'Mouse2012',...
        'Mouse2012',...
        'Mouse2012',...
        'Mouse2012',...
        'Mouse2012',...
        'Mouse2012',...
        'Mouse2012',...
        'Mouse2012',...
        'Mouse2012',...
        'Mouse2012',...
        'Mouse2012',...
        'Mouse2012',...
        'Mouse2012',...
        'Mouse2012',...
        'Mouse2012',...
        'Mouse2012',...
        'Mouse2012',...
        'Mouse2012',...
        'Mouse2012',...
        'Mouse2012',...
        'Mouse2012',...
        'Mouse2012',...
        'Mouse2012',...
        'Mouse2012',...
        'Mouse2012',...
        'Mouse2010',...
        'Mouse2010',...
        'Mouse2010',...
        'Mouse2010',...
        'Mouse2010',...
        'Mouse2010',...
        'Mouse2010',...
        'Mouse2010',...
        'Mouse2010',...
        'Mouse2010',...
        'Mouse2010',...
        'Mouse2010',...
        'Mouse2010',...
        'Mouse2010',...
        'Mouse2010',...
        'Mouse2010',...
        'Mouse2010',...
        'Mouse2010',...
        'Mouse2010',...
        'Mouse2010',...
        'Mouse2010',...
        'Mouse2010',...
        'Mouse2010',...
        'Mouse2010',...
        'Mouse2010',...
        'Mouse2010',...
        'Mouse2010',...
        'Mouse2010',...
        'Mouse2010',...
        'Mouse2010',...
        'Mouse2010',...
        'Mouse2010',...
        'Mouse2010',...
        'Mouse2010',...
        'Mouse2010',...
        'Mouse2010',...
        'Mouse2010',...
        'Mouse2010',...
        'Mouse2028',...
        'Mouse2028',...
        'Mouse2028',...
        'Mouse2028',...
        'Mouse2028',...
        'Mouse2028',...
        'Mouse2028',...
        'Mouse2028',...
        'Mouse2028',...
        'Mouse2028',...
        'Mouse2028',...
        'Mouse2028',...
        'Mouse2028',...
        'Mouse2028',...
        'Mouse2028',...
        'Mouse2028',...
        'Mouse2028',...
        'Mouse2028',...
        'Mouse2019',...
        'Mouse2019',...
        'Mouse2019',...
        'Mouse2019',...
        'Mouse2019',...
        'Mouse2019',...
        'Mouse2019',...
        'Mouse2019',...
        'Mouse2019',...
        'Mouse2019',...
        'Mouse2011',...
        'Mouse2011',...
        'Mouse2011',...
        'Mouse2011',...
        'Mouse2011',...
        'Mouse2011',...
        'Mouse2011',...
        'Mouse2011',...
        'Mouse2011',...
        'Mouse2011',...
        'Mouse2011',...
        'Mouse2011',...
        'Mouse2011',...
        'Mouse2011',...
        'Mouse2011',...
        'Mouse2011',...
        'Mouse2011',...
        'Mouse2011',...
        'Mouse2011',...
        'Mouse2011',...
        'Mouse2011',...
        'Mouse2011',...
        'Mouse2011',...
        'Mouse2011',...
        'Mouse2011',...
        'Mouse2011',...
        'Mouse2011',...
        'Mouse2011',...
        'Mouse2011',...
        'Mouse2011',...
        'Mouse2011',...
        'Mouse2011',...
        'Mouse2011',...
        'Mouse2011',...
        'Mouse2011',...
        'Mouse2011',...
        'Mouse2029',...
        'Mouse2029',...
        'Mouse2029',...
        'Mouse2029',...
        'Mouse2029',...
        'Mouse2029',...
        'Mouse2029',...
        'Mouse2029',...
        'Mouse2029',...
        'Mouse2029',...
        'Mouse2024',...
        'Mouse2024',...
        'Mouse2024',...
        'Mouse2024',...
        'Mouse2024',...
        'Mouse2024',...
        'Mouse2024',...
        'Mouse2024',...
        'Mouse2024',...
        'Mouse2024',...
        'Mouse2024',...
        'Mouse2024',...
        'Mouse2024',...
        'Mouse2024',...
        'Mouse2024',...
        'Mouse2024',...
        'Mouse2024',...
        'Mouse2024',...
        'Mouse2021',...
        'Mouse2021',...
        'Mouse2021',...
        'Mouse2021',...
        'Mouse2021',...
        'Mouse2021',...
        'Mouse2021',...
        'Mouse2021',...
        'Mouse2023',...
        'Mouse2023',...
        'Mouse2023',...
        'Mouse2023',...
        'Mouse2023',...
        'Mouse2023',...
        'Mouse2023',...
        'Mouse2023',...
        'Mouse2023',...
        'Mouse2023',...
        'Mouse2022',...
        'Mouse2022',...
        'Mouse2022',...
        'Mouse2022',...
        'Mouse2022',...
        'Mouse2022',...
        'Mouse2022',...
        'Mouse2022',...
        'Mouse2022',...
        'Mouse2022',...
        'Mouse2022',...
        'Mouse2022',...
        'Mouse2022',...
        'Mouse2026',...
        'Mouse2026',...
        'Mouse2026',...
        'Mouse2026',...
        'Mouse2026',...
        'Mouse2026',...
        'Mouse2026',...
        'Mouse2026',...
        'Mouse2026',...
        'Mouse2026',...
        'Mouse2026',...
        'Mouse2026',...
        'Mouse2026',...
        'Mouse2026',...
        'Mouse2026',...
        'Mouse2026',...
        'Mouse2026',...
        'Mouse2026',...
        'Mouse2026'};
    break;
end

%sessions = {'../linear_track/Mouse2019/Mouse-2019-20150311-linear-track/Mouse-2019-20150311_101049-linear-track-TracesAndEvents.mat',...
%    '../linear_track/Mouse2021/Mouse-2021-20150326-linear-track/Mouse-2021-20150326_085536-linear-track-TracesAndEvents.mat',...
%    '../linear_track/Mouse2022/Mouse-2022-20150326-linear-track/Mouse-2022-20150326_093722-linear-track-TracesAndEvents.mat',...
%    '../linear_track/Mouse2028/Mouse-2028-20150327-linear-track/Mouse-2028-20150327_105544-linear-track-TracesAndEvents.mat',...
%    '../linear_track/Mouse2025/Mouse-2025-20150303-linear-track/Mouse-2025-20150303_091715-linear-track-TracesAndEvents.mat',...
%    '../linear_track/Mouse2024/Mouse-2024-20150311-linear-track/Mouse-2024-20150311_073912-linear-track-TracesAndEvents.mat'};
%sessions_mouse = {'Mouse2019', 'Mouse2021', 'Mouse2022',...
%    'Mouse2028', 'Mouse2025', 'Mouse2024'};
sessions = arrayfun(@DecodeTensor.default_datasets, 1:10, 'UniformOutput', false);
session_mouse = cellfun(@(x) x(17:25), sessions, 'UniformOutput', false);

num_sess = numel(sessions);
me_ = zeros(1, num_sess);
mse_ = me_;
me_s_ = me_;
mse_s_ = me_;
num_neurons = me_;
num_trials_ = me_;
shuf_advantage = me_;
sh_by_unsh = me_;
res = cell(1, num_sess);
time_taken = me_;
%%
for s_i = 1:num_sess
    my_timer = tic;
    try
        session_path = sessions{s_i};
        my_mouse = session_mouse{s_i};
        o = DecodeTensor({session_path, my_mouse});
        %[me_(s_i), mse_(s_i), ~, ~] = o.basic_decode(false, [], []);
        %[me_s_(s_i), mse_s_(s_i), ~, ~] = o.basic_decode(true, [], []);
        num_neurons(s_i) = size(o.data_tensor,1);
        num_trials_(s_i) = size(o.data_tensor,3);
        %shuf_advantage(s_i) = ((1./mse_s_(s_i)) - (1./mse_(s_i))) .* num_neurons(s_i) .* mse_s_(s_i);
        
        res{s_i} = DecodeTensor.noise_properties(o.data_tensor, o.tr_dir, true); %true for using_corr
        sh_by_unsh(s_i) = mean(cell2mat(res{s_i}.nd_pre(:)) ./ cell2mat(res{s_i}.nd_pre_s(:)));
        %rms_noise_corr(s_i) = res{s_i}.RMS_noise_corr;
        %rms_noise_corr_shuf(s_i)
        time_taken(s_i) = toc(my_timer);
        fprintf('Done session %d/%d: shuf_advantage: %.2f\tsh_by_unsh: %.2f\tin time %.2fs\n',...
            s_i, num_sess, shuf_advantage(s_i), sh_by_unsh(s_i), time_taken(s_i));
        %loop_record(s_i) = struct('session_path', session_path, 'my_mouse', my_mouse,...
        %    'mean_err', me_, 'MSE', mse_, 'mean_err_s', me_s_, 'MSE_s', mse_s_',...
        %    'num_neurons', num_neurons, 'num_trials', num_trials_, 'shuf_advantage', shuf_advantage(s_i),...
        %    'res_geometric', res, 'sh_by_unsh', sh_by_unsh(s_i), 'time_taken', time_taken);
    catch e
        shuf_advantage(s_i) = nan;
        sh_by_unsh(s_i) = nan;
        fprintf('ERROR on session %d/%d:\tneu:%d tr:%d time taken: %.2fs\n',...
            s_i, num_sess, num_neurons(s_i), num_trials_(s_i), toc(my_timer));
        disp(e);
    end
end
%%
for s_i = 1:num_sess
    if ~isempty(res{s_i})
        rms_noise_corr(s_i) = res{s_i}.RMS_noise_corr;
        rms_noise_corr_shuf(s_i) = res{s_i}.RMS_noise_corr_shuf;
    end
end
%%
safe_filter = ~isnan(sh_by_unsh(:)) & ~isnan(shuf_advantage(:)) & (num_trials_(:) > 50) & (num_neurons(:) > 50) & (me_(:) < 12) & (me_s_(:) < 12);
sh_by_unsh_safe = sh_by_unsh(safe_filter);
shuf_advantage_safe = shuf_advantage(safe_filter);
session_mouse_safe = session_mouse(safe_filter);

figure;
scatter(sh_by_unsh_safe, shuf_advantage_safe, 4, categorical(session_mouse_safe), 'filled');
[fitresult, gof] = fit(sh_by_unsh_safe(:), shuf_advantage_safe(:), 'poly1');
hold on; 
plot(fitresult, 'k'); legend off
text(6.5, 0, sprintf('adj. R^2=%.2f', gof.adjrsquare));
xlabel(sprintf('Unshuf./Shuf. noise\nvariance ratio'));
ylabel(sprintf('\\Delta1/MSE\nin units of cells'));
colormap lines;
figure_format;
%print_svg('all_sessions_regression_line');
%%
rms_noise_corr_safe = rms_noise_corr(safe_filter);
rms_noise_corr_shuf_safe = rms_noise_corr_shuf(safe_filter);
noise_corr_diff = sqrt(rms_noise_corr_safe.^2 - rms_noise_corr_shuf_safe.^2);
figure;
scatter(rms_noise_corr_safe, shuf_advantage_safe, 4, categorical(session_mouse_safe), 'filled');
[fitresult, gof] = fit(rms_noise_corr_safe.', shuf_advantage_safe.', 'poly1');
hold on; 
plot(fitresult, 'k'); legend off
text(0.2, -100, sprintf('adj. R^2=%.2f', gof.adjrsquare));
xlabel(sprintf('RMS noise correlation'));
ylabel(sprintf('\\Delta1/MSE\nin units of cells'));
colormap lines;
figure_format;
%print_svg('all_sessions_regression_line_RMS_noise_corr');
%% trying other regressions
figure; 
y_values = 1 - mse_s_(safe_filter)./mse_(safe_filter);
%y_values = num_neurons(safe_filter);
scatter(num_neurons(safe_filter), y_values, 4, categorical(session_mouse_safe), 'filled');
[fitresult, gof] = fit(num_neurons(safe_filter).', y_values.', 'poly1');
hold on;
plot(fitresult, 'k'); legend off
xlabel(sprintf('Num neurons'));
ylabel(sprintf('Ratio of MSE shuf/shuf'));
%ylabel 'Num neurons'
text(300, 1, sprintf('adj. R^2=%.2f', gof.adjrsquare));
%% signal direction vs noise angles, over ~150 sessions
%res_safe = res(safe_filter);
res_safe = res;
for i = 1:numel(res_safe)
    my_res = res_safe{i};
    s = cell2mat(reshape(my_res.el_pre',[],1)).^2;
    s_s = cell2mat(reshape(my_res.el_pre_s',[],1)).^2;
    sig_noise(:,i) = cell2mat(reshape(my_res.nd_pre',[],1));
    sig_noise_s(:,i) = cell2mat(reshape(my_res.nd_pre_s',[],1));
    rnd_noise(:,i) = cell2mat(reshape(my_res.nd_rnd',[],1));
    rnd_noise_s(:,i) = cell2mat(reshape(my_res.nd_rnd_s',[],1));
    
    principal_signal_angles(:,i) = acosd(sqrt(s(1:38,1)));
    principal_signal_angles_s(:,i) = acosd(sqrt(s_s(1:38,1)));
    median_loadings(:, i) = median(s(:,1:50));
    median_loadings_s(:, i) = median(s_s(:,1:50));
end
%% TODO change the number above to select PC dimension (50 -> 1)
figure;
bin_labels = [[num2str((1:19)'), repmat('R',19,1)]; [num2str((1:19)'), repmat('L',19,1)]];
subplot(2,1,1);
boxplot(principal_signal_angles', bin_labels);
ylim([40 90]);
title('unshuffled');
%Utils.neuseries(1:19, principal_signal_angles', 'b');
hold on;
xlabel 'Rightward place bin'
ylabel(sprintf('Angle between principal noise\n& signal direction (degrees)'));
subplot(2,1,2);
%Utils.neuseries(1:19, principal_signal_angles_s', 'r');
boxplot(principal_signal_angles_s', bin_labels);
title('shuffled');
ylim([40 90]);
xlabel 'Rightward place bin'
ylabel(sprintf('Angle between principal noise\n& signal direction (degrees)'));
%% median loadings per PC, showing mean +- sem thereof
figure;
Utils.neuseries(1:50, median_loadings', 'b');
hold on;
Utils.neuseries(1:50, median_loadings_s', 'r');
xlabel 'Noise PC index'
ylabel(sprintf('Median signal\ndirection loadings\n(squared)'));
set(gca, 'YScale', 'log'); set(gca, 'XScale', 'log');
xlim([1 50]);
ylim([3e-4 7e-2]);
set(gca, 'YTick', [1e-3 1e-2])
figure_format;
print_svg('signal_pc_loadings_10');
%% boxplots of median noise in the signal direction ratios (median over bins)
figure;
boxplot([median(sig_noise./sig_noise_s)', median(rnd_noise./rnd_noise_s)'], {'Signal', 'Random'}, 'outliersize', 1);
ylabel(sprintf('Unshuf./shuf. noise\nvariance ratio'));
l_ = refline([0 1]); l_.Color = 'k';
figure_format;
print_svg('noise_attenuation_boxplot_10');
%% inset of random boxplot
figure; 
boxplot(median(rnd_noise./rnd_noise_s)', {'Random'}, 'outliersize', 1);
l_ = refline([0 1]); l_.Color = 'k';
figure_format('boxsize', [0.8125 0.585].*0.98/2);
print_svg('noise_attenuation_boxplot_10_inset');
%% ball and stick plot for sig_noise and sig_noise_s
figure;
plot([median(sig_noise) ; median(sig_noise_s)], '-k.');
xlim([0.5 2.5]);
ylim([0 Inf]);
set(gca, 'XTick', [1 2]);
set(gca, 'XTickLabel', {'Unshuffled', 'Shuffled'});
ylabel(sprintf('Noise in\nsignal direction'));
l_ = refline(0,1); l_.Color = 'k';
figure_format;
print_svg('noise_attenuation_stickplot_10');
%% decoding advantage / signal direction variance scatterplot + numneurons control
num_neuron_limit = 200;
num_trials_limit = 50;
for s_i = 155:num_sess
    my_timer = tic;
    try
        session_path = sessions{s_i};
        my_mouse = session_mouse{s_i};
        o = DecodeTensor({session_path, my_mouse});
        [ctrl_num_neurons(s_i), ctrl_n_bins(s_i), ~] = size(o.data_tensor);
        ctrl_n_trials(s_i) = min(sum(o.tr_dir == 1), sum(o.tr_dir == -1));
        if (ctrl_num_neurons(s_i) < num_neuron_limit) || (ctrl_n_trials(s_i) < num_trials_limit)
            ctrl_shuf_advantage(s_i) = nan;
            ctrl_sh_by_unsh(s_i) = nan;
            ctrl_rms_noise_corr(s_i) = nan;
            continue; %ONLY USE 200n100t
        end
        %PLAN: cut the tensor once, just to get neuron & trial subsets,
        %then use them for all the calculations.
        [ctrl_data_tensor, ctrl_tr_dir, ctrl_neuron_subset, ctrl_trial_subset] = DecodeTensor.cut_tensor(o.data_tensor, o.tr_dir, num_neuron_limit, num_trials_limit); %%TODO: choose SAME specific permutations
        
        [ctrl_me_(s_i), ctrl_mse_(s_i), ~, ~] = o.basic_decode(false, ctrl_neuron_subset, ctrl_trial_subset); %TODO: choose specific permutations
        [ctrl_me_s_(s_i), ctrl_mse_s_(s_i), ~, ~] = o.basic_decode(true, ctrl_neuron_subset, ctrl_trial_subset); %%TODO: choose SAME specific permutations
        
        ctrl_shuf_advantage(s_i) = ((1./ctrl_mse_s_(s_i)) - (1./ctrl_mse_(s_i))) .* num_neuron_limit .* ctrl_mse_s_(s_i);
        
        
        ctrl_res{s_i} = DecodeTensor.noise_properties(ctrl_data_tensor, ctrl_tr_dir, true); %true for using_corr
        ctrl_sh_by_unsh(s_i) = mean(cell2mat(ctrl_res{s_i}.nd_pre(:)) ./ cell2mat(ctrl_res{s_i}.nd_pre_s(:)));
        ctrl_rms_noise_corr(s_i) = ctrl_res{s_i}.RMS_noise_corr;
        %rms_noise_corr_shuf(s_i)
        ctrl_time_taken(s_i) = toc(my_timer);
        fprintf('Done session %d/%d: shuf_advantage: %.2f\tsh_by_unsh: %.2f\tin time %.2fs\n',...
            s_i, num_sess, ctrl_shuf_advantage(s_i), ctrl_sh_by_unsh(s_i), ctrl_time_taken(s_i));
        %loop_record(s_i) = struct('session_path', session_path, 'my_mouse', my_mouse,...
        %    'mean_err', me_, 'MSE', mse_, 'mean_err_s', me_s_, 'MSE_s', mse_s_',...
        %    'num_neurons', num_neurons, 'num_trials', num_trials_, 'shuf_advantage', shuf_advantage(s_i),...
        %    'res_geometric', res, 'sh_by_unsh', sh_by_unsh(s_i), 'time_taken', time_taken);
    catch e
        ctrl_shuf_advantage(s_i) = nan;
        ctrl_sh_by_unsh(s_i) = nan;
        ctrl_rms_noise_corr(s_i) = nan;
        fprintf('ERROR on session %d/%d\n', s_i, num_sess);
        %fprintf('ERROR on session %d/%d:\tneu:%d tr:%d time taken: %.2fs\n',...
        %    s_i, num_sess, ctrl_num_neurons(s_i), ctrl_n_trials(s_i), toc(my_timer));
        disp(e); %TODO run it
    end
end
%%
ctrl_safe_filter = ~isnan(ctrl_sh_by_unsh(:)) & ~isnan(ctrl_shuf_advantage(:)) & (ctrl_n_trials(:) > num_trials_limit) & (ctrl_num_neurons(:) > num_neuron_limit) & (ctrl_me_(:) < 12) & (ctrl_me_s_(:) < 12);
ctrl_sh_by_unsh_safe = ctrl_sh_by_unsh(ctrl_safe_filter);
ctrl_shuf_advantage_safe = ctrl_shuf_advantage(ctrl_safe_filter);
ctrl_session_mouse_safe = session_mouse(ctrl_safe_filter);

figure;
scatter(ctrl_sh_by_unsh_safe, ctrl_shuf_advantage_safe, 4, categorical(ctrl_session_mouse_safe), 'filled');
[fitresult, gof] = fit(ctrl_sh_by_unsh_safe(:), ctrl_shuf_advantage_safe(:), 'poly1');
hold on; 
plot(fitresult, 'k'); legend off
text(4, 0, sprintf('adj. R^2=%.2f', gof.adjrsquare));
xlabel(sprintf('Unshuf./Shuf. noise\nvariance ratio (ctrl)'));
ylabel(sprintf('\\Delta1/MSE\nin units of cells (ctrl)'));
colormap lines;
figure_format;
print_svg('ctrl_all_sessions_regression_line');
%%
ctrl_rms_noise_corr_safe = ctrl_rms_noise_corr(ctrl_safe_filter);
%rms_noise_corr_shuf_safe = rms_noise_corr_shuf(safe_filter);
%noise_corr_diff = sqrt(rms_noise_corr_safe.^2 - rms_noise_corr_shuf_safe.^2);
figure;
scatter(ctrl_rms_noise_corr_safe, ctrl_shuf_advantage_safe, 4, categorical(ctrl_session_mouse_safe), 'filled');
[fitresult, gof] = fit(ctrl_rms_noise_corr_safe.', ctrl_shuf_advantage_safe.', 'poly1');
hold on; 
plot(fitresult, 'k'); legend off
text(0.25, 0, sprintf('adj. R^2=%.2f', gof.adjrsquare));
xlabel(sprintf('RMS noise correlation (ctrl)'));
ylabel(sprintf('\\Delta1/MSE\nin units of cells (ctrl)'));
colormap lines;
figure_format;
print_svg('ctrl_all_sessions_regression_line_RMS_noise_corr');
%%
num_sess = numel(sessions);
v_thresh = [0.5 1 1.5 2 2.5 3 3.5 4 4.5 5];
n_trials_found = zeros(num_sess, numel(v_thresh));
%%
for i = 172:num_sess
    load(sessions{i});
    track_coord = tracesEvents.position(:,1);
    opt = DecodeTensor.default_opt;
    
    for j = 1:numel(v_thresh)
        opt.v_thresh = v_thresh(j);
        [~, ~, tr_s, tr_e, tr_dir, tr_bins, ~] =...
            DecodeTensor.new_sel(track_coord, opt);
        n_trials_found(i, j) = numel(tr_s);
    end
end

%%
lookup = @(n) n_trials_found(find(strcmp(sessions, n),1), :);

lookup_cell = @(ns) cellfun(lookup, ns, 'UniformOutput', false);

%%
sheet_paths = {...
'../linear_track/Mouse2023/Mouse-2023-20150228-linear-track/Mouse-2023-20150228_144258-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2023/Mouse-2023-20150228-linear-track/Mouse-2023-20150228_185044-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2023/Mouse-2023-20150301-linear-track/Mouse-2023-20150301_114752-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2023/Mouse-2023-20150301-linear-track/Mouse-2023-20150301_162349-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2023/Mouse-2023-20150306-linear-track/Mouse-2023-20150306_112849-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2023/Mouse-2023-20150311-linear-track/Mouse-2023-20150311_124240-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2023/Mouse-2023-20150316-linear-track/Mouse-2023-20150316_091246-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2023/Mouse-2023-20150321-linear-track/Mouse-2023-20150321_114832-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2023/Mouse-2023-20150326-linear-track/Mouse-2023-20150326_101329-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2023/Mouse-2023-20150331-linear-track/Mouse-2023-20150331_144419-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2024/Mouse-2024-20150228-linear-track/Mouse-2024-20150228_153237-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2024/Mouse-2024-20150301-linear-track/Mouse-2024-20150301_124134-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2024/Mouse-2024-20150301-linear-track/Mouse-2024-20150301_173817-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2024/Mouse-2024-20150303-linear-track/Mouse-2024-20150303_082851-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2024/Mouse-2024-20150305-linear-track/Mouse-2024-20150305_104454-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2024/Mouse-2024-20150307-linear-track/Mouse-2024-20150307_100459-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2024/Mouse-2024-20150309-linear-track/Mouse-2024-20150309_090858&091446-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2024/Mouse-2024-20150311-linear-track/Mouse-2024-20150311_073912-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2024/Mouse-2024-20150313-linear-track/Mouse-2024-20150313_095203-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2024/Mouse-2024-20150315-linear-track/Mouse-2024-20150315_090450-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2024/Mouse-2024-20150317-linear-track/Mouse-2024-20150317_202708-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2024/Mouse-2024-20150319-linear-track/Mouse-2024-20150319_082641-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2024/Mouse-2024-20150321-linear-track/Mouse-2024-20150321_130536&130559-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2024/Mouse-2024-20150323-linear-track/Mouse-2024-20150323_082351-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2024/Mouse-2024-20150325-linear-track/Mouse-2024-20150325_114324-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2024/Mouse-2024-20150327-linear-track/Mouse-2024-20150327_090539-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2024/Mouse-2024-20150329-linear-track/Mouse-2024-20150329_104048-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2024/Mouse-2024-20150331-linear-track/Mouse-2024-20150331_101607-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2028/Mouse-2028-20150228-linear-track/Mouse-2028-20150228_114834-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2028/Mouse-2028-20150228-linear-track/Mouse-2028-20150228_172215-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2028/Mouse-2028-20150301-linear-track/Mouse-2028-20150301_141039-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2028/Mouse-2028-20150301-linear-track/Mouse-2028-20150301_192709-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2028/Mouse-2028-20150303-linear-track/Mouse-2028-20150303_103622-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2028/Mouse-2028-20150305-linear-track/Mouse-2028-20150305_132231-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2028/Mouse-2028-20150307-linear-track/Mouse-2028-20150307_120240-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2028/Mouse-2028-20150309-linear-track/Mouse-2028-20150309_110935-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2028/Mouse-2028-20150311-linear-track/Mouse-2028-20150311_093214-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2028/Mouse-2028-20150313-linear-track/Mouse-2028-20150313_114415-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2028/Mouse-2028-20150315-linear-track/Mouse-2028-20150315_105814-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2028/Mouse-2028-20150317-linear-track/Mouse-2028-20150317_102240-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2028/Mouse-2028-20150319-linear-track/Mouse-2028-20150319_105610-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2028/Mouse-2028-20150321-linear-track/Mouse-2028-20150321_144549-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2028/Mouse-2028-20150323-linear-track/Mouse-2028-20150323_105955-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2028/Mouse-2028-20150325-linear-track/Mouse-2028-20150325_143248-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2028/Mouse-2028-20150327-linear-track/Mouse-2028-20150327_105544-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2028/Mouse-2028-20150329-linear-track/Mouse-2028-20150329_133137-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2010/Mouse-2010-20141125-linear-track/Mouse-2010-20141125_000156-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2010/Mouse-2010-20141126-linear-track/Mouse-2010-20141126_111415-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2010/Mouse-2010-20141126-linear-track/Mouse-2010-20141126_151543-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2010/Mouse-2010-20141128-linear-track/Mouse-2010-20141128_121404-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2010/Mouse-2010-20141130-linear-track/Mouse-2010-20141130_115330-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2010/Mouse-2010-20141202-linear-track/Mouse-2010-20141202_110542-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2010/Mouse-2010-20141203-linear-track/Mouse-2010-20141203_103645-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2010/Mouse-2010-20141205-linear-track/Mouse-2010-20141205_102648-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2010/Mouse-2010-20141207-linear-track/Mouse-2010-20141207_115722-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2010/Mouse-2010-20141209-linear-track/Mouse-2010-20141209_101632-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2010/Mouse-2010-20141211-linear-track/Mouse-2010-20141211_140916-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2010/Mouse-2010-20141213-linear-track/Mouse-2010-20141213_115553-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2010/Mouse-2010-20141215-linear-track/Mouse-2010-20141215_125115-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2010/Mouse-2010-20141217-linear-track/Mouse-2010-20141217_120259-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2010/Mouse-2010-20141219-linear-track/Mouse-2010-20141219_105955-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2010/Mouse-2010-20141221-linear-track/Mouse-2010-20141221_113118&115136-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2010/Mouse-2010-20141223-linear-track/Mouse-2010-20141223_094533-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2010/Mouse-2010-20150112-linear-track/Mouse-2010-20150112_103135-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2010/Mouse-2010-20150113-linear-track/Mouse-2010-20150113_160417-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2010/Mouse-2010-20150114-linear-track/Mouse-2010-20150114_152716-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2010/Mouse-2010-20150116-linear-track/Mouse-2010-20150116_113236-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2010/Mouse-2010-20150118-linear-track/Mouse-2010-20150118_112236-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2010/Mouse-2010-20150120-linear-track/Mouse-2010-20150120_095710-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2010/Mouse-2010-20150122-linear-track/Mouse-2010-20150122_093836-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2010/Mouse-2010-20150123-linear-track/Mouse-2010-20150123_150954-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2010/Mouse-2010-20150124-linear-track/Mouse-2010-20150124_111828-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2010/Mouse-2010-20150126-linear-track/Mouse-2010-20150126_094735-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2010/Mouse-2010-20150128-linear-track/Mouse-2010-20150128_111752-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2010/Mouse-2010-20150130-linear-track/Mouse-2010-20150130_094711-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2010/Mouse-2010-20150201-linear-track/Mouse-2010-20150201_111454-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2010/Mouse-2010-20150202-linear-track/Mouse-2010-20150202_101928-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2010/Mouse-2010-20150203-linear-track/Mouse-2010-20150203_103253-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2010/Mouse-2010-20150205-linear-track/Mouse-2010-20150205_102524-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2010/Mouse-2010-20150207-linear-track/Mouse-2010-20150207_114314-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2010/Mouse-2010-20150209-linear-track/Mouse-2010-20150209_100711-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2010/Mouse-2010-20150211-linear-track/Mouse-2010-20150211_160238-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2010/Mouse-2010-20150212-linear-track/Mouse-2010-20150212_094703-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2012/Mouse-2012-20141123-linear-track/Mouse-2012-20141123_000520-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2012/Mouse-2012-20141125-linear-track/Mouse-2012-20141125_030700-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2012/Mouse-2012-20141125-linear-track/Mouse-2012-20141125_215941-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2012/Mouse-2012-20141126-linear-track/Mouse-2012-20141126_085441-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2012/Mouse-2012-20141127-linear-track/Mouse-2012-20141127_101659-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2012/Mouse-2012-20141129-linear-track/Mouse-2012-20141129_100639-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2012/Mouse-2012-20141201-linear-track/Mouse-2012-20141201_083556-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2012/Mouse-2012-20141203-linear-track/Mouse-2012-20141203_084234-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2012/Mouse-2012-20141205-linear-track/Mouse-2012-20141205_083324-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2012/Mouse-2012-20141207-linear-track/Mouse-2012-20141207_100218-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2012/Mouse-2012-20141209-linear-track/Mouse-2012-20141209_082401-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2012/Mouse-2012-20141211-linear-track/Mouse-2012-20141211_121707-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2012/Mouse-2012-20141213-linear-track/Mouse-2012-20141213_100118-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2012/Mouse-2012-20141215-linear-track/Mouse-2012-20141215_110325-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2012/Mouse-2012-20141217-linear-track/Mouse-2012-20141217_104915-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2012/Mouse-2012-20141219-linear-track/Mouse-2012-20141219_094111-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2012/Mouse-2012-20141221-linear-track/Mouse-2012-20141221_095806-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2012/Mouse-2012-20141223-linear-track/Mouse-2012-20141223_082741-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2012/Mouse-2012-20150112-linear-track/Mouse-2012-20150112_085723-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2012/Mouse-2012-20150113-linear-track/Mouse-2012-20150113_141832-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2012/Mouse-2012-20150114-linear-track/Mouse-2012-20150114_140933-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2012/Mouse-2012-20150116-linear-track/Mouse-2012-20150116_101239-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2012/Mouse-2012-20150118-linear-track/Mouse-2012-20150118_100831-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2012/Mouse-2012-20150118-linear-track/Mouse-2012-20150118_122056-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2012/Mouse-2012-20150120-linear-track/Mouse-2012-20150120_083419-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2012/Mouse-2012-20150122-linear-track/Mouse-2012-20150122_082416-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2012/Mouse-2012-20150123-linear-track/Mouse-2012-20150123_135330-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2012/Mouse-2012-20150124-linear-track/Mouse-2012-20150124_100435-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2012/Mouse-2012-20150126-linear-track/Mouse-2012-20150126_083013-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2012/Mouse-2012-20150128-linear-track/Mouse-2012-20150128_100143-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2012/Mouse-2012-20150128-linear-track/Mouse-2012-20150128_171615-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2012/Mouse-2012-20150130-linear-track/Mouse-2012-20150130_102501-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2012/Mouse-2012-20150201-linear-track/Mouse-2012-20150201_095905-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2012/Mouse-2012-20150202-linear-track/Mouse-2012-20150202_085844-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2012/Mouse-2012-20150203-linear-track/Mouse-2012-20150203_091636-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2012/Mouse-2012-20150205-linear-track/Mouse-2012-20150205_090558-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2012/Mouse-2012-20150207-linear-track/Mouse-2012-20150207_102450-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2012/Mouse-2012-20150207-linear-track/Mouse-2012-20150207_134254-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2012/Mouse-2012-20150209-linear-track/Mouse-2012-20150209_084856-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2012/Mouse-2012-20150211-linear-track/Mouse-2012-20150211_151241-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2012/Mouse-2012-20150212-linear-track/Mouse-2012-20150212_082737-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2019/Mouse-2019-20150228-linear-track/Mouse-2019-20150228_130909-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2019/Mouse-2019-20150228-linear-track/Mouse-2019-20150228_174527-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2019/Mouse-2019-20150301-linear-track/Mouse-2019-20150301_104001-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2019/Mouse-2019-20150301-linear-track/Mouse-2019-20150301_143437-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2019/Mouse-2019-20150306-linear-track/Mouse-2019-20150306_093422-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2019/Mouse-2019-20150311-linear-track/Mouse-2019-20150311_101049-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2019/Mouse-2019-20150316-linear-track/Mouse-2019-20150316_072301-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2019/Mouse-2019-20150321-linear-track/Mouse-2019-20150321_095525-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2019/Mouse-2019-20150326-linear-track/Mouse-2019-20150326_081710-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2019/Mouse-2019-20150331-linear-track/Mouse-2019-20150331_125138-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2022/Mouse-2022-20150316-linear-track/Mouse-2022-20150316_083627-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2022/Mouse-2022-20150306-linear-track/Mouse-2022-20150306_104914-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2022/Mouse-2022-20150227-linear-track/Mouse-2022-20150227_182234-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2022/Mouse-2022-20150228-linear-track/Mouse-2022-20150228_182558-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2022/Mouse-2022-20150228-linear-track/Mouse-2022-20150228_142050-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2022/Mouse-2022-20150321-linear-track/Mouse-2022-20150321_111200-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2022/Mouse-2022-20150331-linear-track/Mouse-2022-20150331_140317-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2022/Mouse-2022-20150311-linear-track/Mouse-2022-20150311_112532-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2022/Mouse-2022-20150329-linear-track/Mouse-2022-20150329_100439-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2022/Mouse-2022-20150326-linear-track/Mouse-2022-20150326_093722-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2022/Mouse-2022-20150301-linear-track/Mouse-2022-20150301_112611-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2022/Mouse-2022-20150301-linear-track/Mouse-2022-20150301_154837-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2022/Mouse-2022-20150327-linear-track/Mouse-2022-20150327_082741-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2026/Mouse-2026-20150307-linear-track/Mouse-2026-20150307_112614-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2026/Mouse-2026-20150331-linear-track/Mouse-2026-20150331_090237-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2026/Mouse-2026-20150323-linear-track/Mouse-2026-20150323_102333-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2026/Mouse-2026-20150327-linear-track/Mouse-2026-20150327_101915-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2026/Mouse-2026-20150329-linear-track/Mouse-2026-20150329_115639-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2026/Mouse-2026-20150319-linear-track/Mouse-2026-20150319_101913-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2026/Mouse-2026-20150325-linear-track/Mouse-2026-20150325_135422-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2026/Mouse-2026-20150305-linear-track/Mouse-2026-20150305_115921-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2026/Mouse-2026-20150311-linear-track/Mouse-2026-20150311_085602-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2026/Mouse-2026-20150303-linear-track/Mouse-2026-20150303_095846-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2026/Mouse-2026-20150309-linear-track/Mouse-2026-20150309_103302-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2026/Mouse-2026-20150315-linear-track/Mouse-2026-20150315_102127-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2026/Mouse-2026-20150321-linear-track/Mouse-2026-20150321_141554-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2026/Mouse-2026-20150313-linear-track/Mouse-2026-20150313_110801-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2026/Mouse-2026-20150301-linear-track/Mouse-2026-20150301_132603-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2026/Mouse-2026-20150301-linear-track/Mouse-2026-20150301_185053-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2026/Mouse-2026-20150228-linear-track/Mouse-2026-20150228_110319-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2026/Mouse-2026-20150228-linear-track/Mouse-2026-20150228_162802-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2026/Mouse-2026-20150317-linear-track/Mouse-2026-20150317_094553-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2011/Mouse-2011-20141123-linear-track/Mouse-2011-20141123_003522-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2011/Mouse-2011-20141125-linear-track/Mouse-2011-20141125_033559-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2011/Mouse-2011-20141125-linear-track/Mouse-2011-20141125_223115-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2011/Mouse-2011-20141126-linear-track/Mouse-2011-20141126_102932-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2011/Mouse-2011-20141126-linear-track/Mouse-2011-20141126_142057-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2011/Mouse-2011-20141127-linear-track/Mouse-2011-20141127_105556-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2011/Mouse-2011-20141129-linear-track/Mouse-2011-20141129_104511-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2011/Mouse-2011-20141201-linear-track/Mouse-2011-20141201_091423-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2011/Mouse-2011-20141203-linear-track/Mouse-2011-20141203_092044-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2011/Mouse-2011-20141207-linear-track/Mouse-2011-20141207_104116-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2011/Mouse-2011-20141209-linear-track/Mouse-2011-20141209_090137-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2011/Mouse-2011-20141211-linear-track/Mouse-2011-20141211_125424-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2011/Mouse-2011-20141213-linear-track/Mouse-2011-20141213_104253-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2011/Mouse-2011-20141215-linear-track/Mouse-2011-20141215_113956-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2011/Mouse-2011-20141217-linear-track/Mouse-2011-20141217_112712-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2011/Mouse-2011-20141219-linear-track/Mouse-2011-20141219_102235-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2011/Mouse-2011-20141221-linear-track/Mouse-2011-20141221_103622-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2011/Mouse-2011-20141223-linear-track/Mouse-2011-20141223_090517-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2011/Mouse-2011-20150112-linear-track/Mouse-2011-20150112_094026-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2011/Mouse-2011-20150113-linear-track/Mouse-2011-20150113_150037-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2011/Mouse-2011-20150116-linear-track/Mouse-2011-20150116_105412-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2011/Mouse-2011-20150118-linear-track/Mouse-2011-20150118_104559-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2011/Mouse-2011-20150120-linear-track/Mouse-2011-20150120_091222-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2011/Mouse-2011-20150122-linear-track/Mouse-2011-20150122_090159-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2011/Mouse-2011-20150124-linear-track/Mouse-2011-20150124_104148-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2011/Mouse-2011-20150126-linear-track/Mouse-2011-20150126_091016-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2011/Mouse-2011-20150128-linear-track/Mouse-2011-20150128_103926-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2011/Mouse-2011-20150128-linear-track/Mouse-2011-20150128_175300-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2011/Mouse-2011-20150130-linear-track/Mouse-2011-20150130_091036-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2011/Mouse-2011-20150203-linear-track/Mouse-2011-20150203_095456-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2011/Mouse-2011-20150205-linear-track/Mouse-2011-20150205_094701-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2011/Mouse-2011-20150207-linear-track/Mouse-2011-20150207_110324-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2011/Mouse-2011-20150207-linear-track/Mouse-2011-20150207_142436-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2011/Mouse-2011-20150209-linear-track/Mouse-2011-20150209_092502-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2011/Mouse-2011-20150211-linear-track/Mouse-2011-20150211_163711-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2011/Mouse-2011-20150212-linear-track/Mouse-2011-20150212_090836-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2021/Mouse-2021-20150228-linear-track/Mouse-2021-20150228_180537-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2021/Mouse-2021-20150301-linear-track/Mouse-2021-20150301_110509-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2021/Mouse-2021-20150301-linear-track/Mouse-2021-20150301_151117-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2021/Mouse-2021-20150306-linear-track/Mouse-2021-20150306_101057-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2021/Mouse-2021-20150311-linear-track/Mouse-2021-20150311_104705-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2021/Mouse-2021-20150316-linear-track/Mouse-2021-20150316_075956-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2021/Mouse-2021-20150326-linear-track/Mouse-2021-20150326_085536-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2021/Mouse-2021-20150331-linear-track/Mouse-2021-20150331_132808-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2025/Mouse-2025-20150228-linear-track/Mouse-2025-20150228_160317-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2025/Mouse-2025-20150301-linear-track/Mouse-2025-20150301_130341-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2025/Mouse-2025-20150301-linear-track/Mouse-2025-20150301_181458-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2025/Mouse-2025-20150303-linear-track/Mouse-2025-20150303_091715-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2025/Mouse-2025-20150305-linear-track/Mouse-2025-20150305_112222-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2025/Mouse-2025-20150307-linear-track/Mouse-2025-20150307_104428-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2025/Mouse-2025-20150309-linear-track/Mouse-2025-20150309_095611-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2025/Mouse-2025-20150311-linear-track/Mouse-2025-20150311_081758-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2025/Mouse-2025-20150313-linear-track/Mouse-2025-20150313_103035-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2025/Mouse-2025-20150315-linear-track/Mouse-2025-20150315_094432-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2025/Mouse-2025-20150317-linear-track/Mouse-2025-20150317_090833-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2025/Mouse-2025-20150319-linear-track/Mouse-2025-20150319_090510-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2025/Mouse-2025-20150319-linear-track/Mouse-2025-20150319_095211-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2025/Mouse-2025-20150321-linear-track/Mouse-2025-20150321_134149-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2025/Mouse-2025-20150323-linear-track/Mouse-2025-20150323_090111-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2025/Mouse-2025-20150325-linear-track/Mouse-2025-20150325_131626-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2025/Mouse-2025-20150327-linear-track/Mouse-2025-20150327_094347-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2025/Mouse-2025-20150329-linear-track/Mouse-2025-20150329_111804-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2025/Mouse-2025-20150331-linear-track/Mouse-2025-20150331_082446-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2029/Mouse-2029-20150228-linear-track/Mouse-2029-20150228_120509-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2029/Mouse-2029-20150228-linear-track/Mouse-2029-20150228_150949-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2029/Mouse-2029-20150301-linear-track/Mouse-2029-20150301_121435-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2029/Mouse-2029-20150301-linear-track/Mouse-2029-20150301_165938-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2029/Mouse-2029-20150306-linear-track/Mouse-2029-20150306_121634-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2029/Mouse-2029-20150311-linear-track/Mouse-2029-20150311_131945-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2029/Mouse-2029-20150316-linear-track/Mouse-2029-20150316_094956-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2029/Mouse-2029-20150321-linear-track/Mouse-2029-20150321_122709-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2029/Mouse-2029-20150326-linear-track/Mouse-2029-20150326_105003-linear-track-TracesAndEvents.mat',...
'../linear_track/Mouse2029/Mouse-2029-20150331-linear-track/Mouse-2029-20150331_152034-linear-track-TracesAndEvents.mat'};


%% panel A: decorrelation result for Mouse2022/21/24

%creating figure 1
svg_save_dir = 'supplements_svg';
print_svg = @(name) print('-dsvg', fullfile(svg_save_dir, [name '.svg']));
%%
% Caption: Inverse mean squared error for a neural decoder for place as a
% function of number of cells included in the decoder. Aggregated over 20
% random cell subsets of fixed size, shown for one mouse. 
% Shaded regions represent 95% confidence range.
% Trial shuffled data does not reach a performance saturation at 500 neurons, whereas
% unshuffled data does.
name = 'DataSeries';
figure;

dbfile = 'decoding.db';

conn = sqlite(dbfile); %remember to close it
%DecodingPlotGenerator.plot_mice(conn, {'Mouse2022'}, 'shuffled', 'NumNeurons', 'IMSE', 'max');
%DecodingPlotGenerator.plot_mice(conn, {'Mouse2022'}, 'unshuffled', 'NumNeurons', 'IMSE', 'max');
mouse_list = {'Mouse2022', 'Mouse2019', 'Mouse2028'};
for m_i = 1:numel(mouse_list)
    mouse = mouse_list{m_i};
    %disp(mouse);
    %[n,m,e] = DecodingPlotGenerator.get_errors('DataSize', conn, mouse, 'unshuffled', 'IMSE', 'max');
    [ns,ms,es] = DecodingPlotGenerator.get_errors('DataSize', conn, mouse, 'shuffled', 'IMSE', 'max');
    hold on;
    DecodingPlotGenerator.errors_plotter(ns,ms,es, 'shuffled');
    %DecodingPlotGenerator.errors_plotter(n,m,e, 'unshuffled');
end
for m_i = 1:numel(mouse_list)
    mouse = mouse_list{m_i};
    %disp(mouse);
    [n,m,e] = DecodingPlotGenerator.get_errors('DataSize', conn, mouse, 'unshuffled', 'IMSE', 'max');
    %[ns,ms,es] = DecodingPlotGenerator.get_errors('DataSize', conn, mouse, 'shuffled', 'IMSE', 'max');
    hold on;
    %DecodingPlotGenerator.errors_plotter(ns,ms,es, 'shuffled');
    DecodingPlotGenerator.errors_plotter(n,m,e, 'unshuffled');
end
xlabel 'Number of trials'
ylabel '1/MSE (cm^{-2})'
xlim([0 200]);
text(100, 0.325/5.9, 'Unshuffled', 'Color', 'blue');
text(15, 0.8/5.9, 'Shuffled', 'Color', 'red');
line([30 30], ylim, 'Color', 'k', 'LineStyle', ':');
figure_format([0.8125 1.5], 'fontsize', 6*6/6.4);

print_svg(name);
%print('-dsvg', fullfile(svg_save_dir, 'A.svg'));
%print('-dpng', '-r900', fullfile(svg_save_dir, 'A.png'));
%body
figure;
for m_i = 1:numel(mouse_list)
    mouse = mouse_list{m_i};
    %disp(mouse);
    [n,m,e] = DecodingPlotGenerator.get_errors('DataSize', conn, mouse, 'unshuffled', 'IMSE', 'max');
    [ns,ms,es] = DecodingPlotGenerator.get_errors('DataSize', conn, mouse, 'shuffled', 'IMSE', 'max');
    hold on;
    DecodingPlotGenerator.errors_plotter(ns, ms./m, ms./m.*sqrt((es./ms).^2+(e./m).^2), 'bah');
    %DecodingPlotGenerator.errors_plotter(n,m,e, 'unshuffled');
end

xlabel 'Number of trials'
ylabel '1/MSE ratio'
xlim([0 200]);
text(35, 1, sprintf('Shuffled/Unshuffled'), 'Color', 'black');
line([30 30], ylim, 'Color', 'k', 'LineStyle', ':');
figure_format([0.8125 1.5], 'fontsize', 6*6/6.4);

print_svg('shuf_unshuf_ratio');
conn.close;
%%
dbfile = 'decoding_all_sess.db';

conn = sqlite(dbfile); %remember to close it
%mouse_list = {'091246', '073912', '105544', '121404', '104915',...
%              '125138', '093722', '115921', '104559', '104705', '103035', '105003'};
[sess_list, mouse_list] = DecodeTensor.filt_sess_id_list;
progressbar('sessions');
for s_i = 1:numel(sess_list)
    sess = sess_list{s_i};
    %disp(mouse);
    [n,m,e] = DecodingPlotGenerator.get_errors('NumNeurons', conn, sess, 'unshuffled', 'IMSE', 'max');
    [fitresult{s_i}, gof{s_i}] = createFit_infoSaturation(n, m);
    
    [ns,ms,es] = DecodingPlotGenerator.get_errors('NumNeurons', conn, sess, 'shuffled', 'IMSE', 'max');
    [fitresult_s{s_i}, gof_s{s_i}] = createFit_infoSaturation(ns, ms);
    
    [nd,md,ed] = DecodingPlotGenerator.get_errors('NumNeurons', conn, sess, 'diagonal', 'IMSE', 'max');
    [fitresult_d{s_i}, gof_d{s_i}] = createFit_infoSaturation(nd, md);
    
    [N_vals{s_i}, N_confs{s_i}] = Utils.partial_fits(n, m);
    n_size_values{s_i} = n;
    %[ns,ms,es] = DecodingPlotGenerator.get_errors('DataSize', conn, mouse, 'shuffled', 'IMSE', 'max');
    %hold on;
    
    %%N_estimation_err = diff(N_confs)/2;
    %%semilogy(n, N_estimation_err);
    %%est_err_at_150(m_i) = N_estimation_err(n == 150)./N_vals(end);
    %plot(n, N_confs(1, :) > 0);
    
    %%DecodingPlotGenerator.errors_plotter(n, N_vals, diff(N_confs)/2, 'unshuffled');
    %DecodingPlotGenerator.errors_plotter(ns, ms./m, ms./m.*sqrt((es./ms).^2+(e./m).^2), 'bah');
    %DecodingPlotGenerator.errors_plotter(n,m,e, 'unshuffled');
    progressbar(s_i/numel(sess_list));
end
%xlabel 'Number of cells'
%ylabel 'N estimate'
%xlim([0 500]);
%set(gca, 'YScale', 'log');
conn.close;

save 'fit_result_record.mat' sess_list mouse_list fitresult fitresult_s fitresult_d gof gof_s gof_d N_vals N_confs n_size_values
%%
figure;
for i=1:107
    plot(n_size_values{i}, N_confs{i}(1,:), 'o');
    hold on;
end
line([150 150], ylim, 'Color', 'k', 'LineStyle', '-');
%%

name = 'DataSize_controlled';
figure;

dbfile = 'decoding.db';

conn = sqlite(dbfile); %remember to close it
%DecodingPlotGenerator.plot_mice(conn, {'Mouse2022'}, 'shuffled', 'NumNeurons', 'IMSE', 'max');
%DecodingPlotGenerator.plot_mice(conn, {'Mouse2022'}, 'unshuffled', 'NumNeurons', 'IMSE', 'max');
mouse_list = {'Mouse2022', 'Mouse2019', 'Mouse2028'};
for m_i = 1:numel(mouse_list)
    mouse = mouse_list{m_i};
    disp(mouse);
    [n,m,e] = DecodingPlotGenerator.get_errors('NumNeurons', conn, mouse, 'unshuffled', 'IMSE', 156);
    [ns,ms,es] = DecodingPlotGenerator.get_errors('NumNeurons', conn, mouse, 'shuffled', 'IMSE', 156);
    hold on;
    DecodingPlotGenerator.errors_plotter(ns,ms,es, 'shuffled');
    DecodingPlotGenerator.errors_plotter(n,m,e, 'unshuffled');
end
xlabel 'Number of cells'
ylabel '1/MSE (cm^{-2})'
xlim([0 500]);
text(200+50, 0.3/5.9, 'Unshuffled', 'Color', 'blue');
text(55, 0.8/5.9, 'Shuffled', 'Color', 'red');
figure_format;

print_svg(name);
%print('-dsvg', fullfile(svg_save_dir, 'A.svg'));
%print('-dpng', '-r900', fullfile(svg_save_dir, 'A.png'));
%body
conn.close;

%%
name = 'DataSize_uncontrolled';
figure;

dbfile = 'decoding.db';

conn = sqlite(dbfile); %remember to close it
%DecodingPlotGenerator.plot_mice(conn, {'Mouse2022'}, 'shuffled', 'NumNeurons', 'IMSE', 'max');
%DecodingPlotGenerator.plot_mice(conn, {'Mouse2022'}, 'unshuffled', 'NumNeurons', 'IMSE', 'max');
mouse_list = {'Mouse2022', 'Mouse2019', 'Mouse2028'};
for m_i = 1:numel(mouse_list)
    mouse = mouse_list{m_i};
    disp(mouse);
    [n,m,e] = DecodingPlotGenerator.get_errors('NumNeurons', conn, mouse, 'unshuffled', 'IMSE', 'max');
    [ns,ms,es] = DecodingPlotGenerator.get_errors('NumNeurons', conn, mouse, 'shuffled', 'IMSE', 'max');
    hold on;
    DecodingPlotGenerator.errors_plotter(ns,ms,es, 'shuffled');
    DecodingPlotGenerator.errors_plotter(n,m,e, 'unshuffled');
end
xlabel 'Number of cells'
ylabel '1/MSE (cm^{-2})'
xlim([0 500]);
text(200+50, 0.3/5.9, 'Unshuffled', 'Color', 'blue');
text(55, 0.8/5.9, 'Shuffled', 'Color', 'red');
figure_format;

print_svg(name);
%print('-dsvg', fullfile(svg_save_dir, 'A.svg'));
%print('-dpng', '-r900', fullfile(svg_save_dir, 'A.png'));
%body
conn.close;

%% do simple decode with raw_traces and spikeDeconv, on 3-4 mice
% for i = 1:12
%     D_T = DecodeTensor(i, 'rawTraces');
%     
%     [mean_err, MSE(i), ps, ks, ~] = D_T.basic_decode(false, [], []);
%     [mean_err_s, MSE_s(i), ps_s, ks_s, ~] = D_T.basic_decode(true, [], []);
%     
%     
%     D_T_spike = DecodeTensor(i, 'spikeDeconv');
%     
%     [mean_err, MSE_spike(i), ps, ks, ~] = D_T_spike.basic_decode(false, [], []);
%     [mean_err_s, MSE_spike_s(i), ps_s, ks_s, ~] = D_T_spike.basic_decode(true, [], []);
%     
%     %ps = ceil(ps/2);
%     %ks = ceil(ks/2);
%     %ps_s = ceil(ps_s/2);
%     %ks_s = ceil(ks_s/2);
%     
%     %num_trials(i) = 2*D_T.n_one_dir_trials;
%     %C = confusionmat(ks, ps); %./ (2*D_T.n_one_dir_trials);
%     %C_s = confusionmat(ks_s, ps_s);% ./ (2*D_T.n_one_dir_trials);
%     %C_perfect = confusionmat(ks_s, ks);% ./ (2*D_T.n_one_dir_trials);
%     %CDiff(:,:,i) = C_s - C;
%     %CsC = (C_s - C)./C;
%     %CsC(isnan(CsC)) = 0;
%     disp(i);
% end
% %% plot for above
% imse = 1./MSE; imse_spike = 1./MSE_spike;
% imse_s = 1./MSE_s; imse_spike_s = 1./MSE_spike_s;
% 
% num_neurons = [182 202 304 497 239 422 272 257 197 451 210 441];
% 
% shuf_diff = (1 - imse./imse_s) .* num_neurons;
% shuf_diff_spike = (1 - imse_spike./imse_spike_s) .* num_neurons;
% 
% figure;
% boxplot([shuf_diff.' , shuf_diff_spike.'], {'Traces', 'OASIS detected'});
%% Decoding from padded events
name = 'Decoding_from_padded_events';
figure;

dbfile = 'padded_events_decoding.db';

conn = sqlite(dbfile); %remember to close it
%DecodingPlotGenerator.plot_mice(conn, {'Mouse2022'}, 'shuffled', 'NumNeurons', 'IMSE', 'max');
%DecodingPlotGenerator.plot_mice(conn, {'Mouse2022'}, 'unshuffled', 'NumNeurons', 'IMSE', 'max');
%mouse_list = {'Mouse2022', 'Mouse2019', 'Mouse2028'};
mouse_list = {'Mouse2019', 'Mouse2022', 'Mouse2024'};
for m_i = 1:numel(mouse_list)
    mouse = mouse_list{m_i};
    disp(mouse);
    [n,m,e] = DecodingPlotGenerator.get_errors('NumNeurons', conn, mouse, 'unshuffled', 'IMSE', 'max');
    [ns,ms,es] = DecodingPlotGenerator.get_errors('NumNeurons', conn, mouse, 'shuffled', 'IMSE', 'max');
    hold on;
    DecodingPlotGenerator.errors_plotter(ns,ms,es, 'shuffled');
    DecodingPlotGenerator.errors_plotter(n,m,e, 'unshuffled');
end
xlabel 'Number of cells'
ylabel '1/MSE (cm^{-2})'
xlim([0 500]);
text(200+50, 0.003, 'Unshuffled', 'Color', 'blue');
text(40, 0.025, 'Shuffled', 'Color', 'red');

figure_format;

print_svg(name);
%print('-dsvg', fullfile(svg_save_dir, 'A.svg'));
%print('-dpng', '-r900', fullfile(svg_save_dir, 'A.png'));
%body
conn.close;

%% confusion mat %%TODO
for i = 1:12
D_T = DecodeTensor(i, 'FST_padded');

[~, ~, ps, ks, ~] = D_T.basic_decode(false, [], []);
[~, ~, ps_s, ks_s, ~] = D_T.basic_decode(true, [], []);

ps = ceil(ps/2);
ks = ceil(ks/2);
ps_s = ceil(ps_s/2);
ks_s = ceil(ks_s/2);

num_trials(i) = 2*D_T.n_one_dir_trials;
C = confusionmat(ks, ps); %./ (2*D_T.n_one_dir_trials);
C_s = confusionmat(ks_s, ps_s);% ./ (2*D_T.n_one_dir_trials);
C_perfect = confusionmat(ks_s, ks);% ./ (2*D_T.n_one_dir_trials);
CDiff(:,:,i) = C_s - C;
CsC = (C_s - C)./C;
CsC(isnan(CsC)) = 0;
disp(i);
end
%
figure;
m_CDiff = squeeze(sum(CDiff,3))./sum(num_trials);
imagesc(m_CDiff);
colorbar;
%title('Shuffled - Unshuffled');
colormap(bluewhitered);
xlabel 'Predicted bin'
ylabel 'Correct bin'
axis equal;
xlim([0.5 20.5]); ylim([0.5 20.5]);
figure_format('boxsize', [0.75 0.85]); box on;
print_svg('confusion_diff_events');
% figure; 
% imagesc(C_perfect); colorbar; colormap(bluewhitered);
% title('Perfect CM');
% xlabel 'Predicted bin'
% ylabel 'Correct bin'
% figure;
% imagesc(confusionmat(ks_s, ps_s));
% colorbar;
% title('Shuffled');
%%  panel: full vs diagonal decoder on one mouse (from padded events):
name = 'Decoding_from_padded_events_fulldiagonal';
figure;

dbfile = 'padded_events_decoding.db';

conn = sqlite(dbfile); %remember to close it
mouse_list = {'Mouse2019', 'Mouse2022', 'Mouse2024'};
for m_i = 1:numel(mouse_list)
    mouse = mouse_list{m_i};
    [n,m,e] = DecodingPlotGenerator.get_errors('NumNeurons', conn, mouse, 'unshuffled', 'IMSE', 'max');
    [ns,ms,es] = DecodingPlotGenerator.get_errors('NumNeurons', conn, mouse, 'diagonal', 'IMSE', 'max');
    hold on;
    DecodingPlotGenerator.errors_plotter(ns,ms,es, 'diagonal');
    DecodingPlotGenerator.errors_plotter(n,m,e, 'unshuffled');
end
xlabel 'Number of cells'
ylabel '1/MSE (cm^{-2})'
%ylabel '1/MSE (m^{-2})'
xlim([0 500]);
text(10, 0.019, 'Full', 'Color', 'blue');
text(10, 0.016, 'Diagonal', 'Color', 'magenta');
figure_format;


print_svg(name);
conn.close;

%% events padding length vs. decoding accuracy
pad_second_values = [0 0.25 0.4 0.5 0.55 0.6 0.65 0.7 0.75 0.8 0.85 0.9 0.95 1 1.5 2];
%pad_second_values = (0:5:60)/20;
n_reps = 20;
%mean_err_pad = zeros(n_reps, numel(pad_second_values));
%MSE_pad = mean_err_pad;
%ps_pad = cell(n_reps, numel(pad_second_values));
%ks_pad = ps_pad;
for rep = 1:n_reps
    parfor i_p = 1:numel(pad_second_values)
        opt = DecodeTensor.default_opt;
        opt.neural_data_type = 'FST_padded';
        opt.pad_seconds = pad_second_values(i_p);
        D_T = DecodeTensor(4, 'fake', opt);
        my_timing = tic;
        [mean_err_pad(rep, i_p), MSE_pad(rep, i_p), ps_pad{rep,i_p}, ks_pad{rep,i_p}, ~] = D_T.basic_decode(false, [], []);
        fprintf('%d (s):: Unshuffled decoding with %.2f padding: m_e: %.2f\tMSE: %.2f\n',...
            round(toc(my_timing)), opt.pad_seconds, mean_err_pad(rep, i_p), MSE_pad(rep, i_p));
    end
end
save(sprintf('ideal_pad_%s.mat', timestring), 'mean_err_pad', 'MSE_pad', 'ps_pad', 'ks_pad', 'pad_second_values');
%%
figure; shadedErrorBar(pad_second_values, mean(1./MSE_pad), std(1./MSE_pad)./sqrt(n_reps));
xlabel 'Padding duration (s)'
ylabel '1/MSE (cm^{-2})'
text(0.38, 0.003, '0.8s');
figure_format;
hold on; l_ = line([0.8 0.8], ylim); l_.Color = 'k';
print_svg('optimal_padding');


%% panel: decorrelation, pooled on all mice
% and normed to 1 on the imse perf at 
% n_cells = 180 for shuffled
name = 'decorrelation_pooled_normed';
dbfile = 'padded_events_decoding.db';
conn = sqlite(dbfile); %remember to close it
%mouse_list = {'Mouse2010', 'Mouse2012', 'Mouse2019', 'Mouse2022',...
%                'Mouse2023', 'Mouse2024', 'Mouse2026', 'Mouse2028',...
%                'Mouse2025', 'Mouse2011', 'Mouse2029', 'Mouse2021'};
mouse_list = {'Mouse2019', 'Mouse2021', 'Mouse2022',...
    'Mouse2028', 'Mouse2025', 'Mouse2024'}; %only mice with >80 trials

for i = 1:numel(mouse_list)
    [nP{i}, mP{i}, eP{i}] = ...
        DecodingPlotGenerator.get_errors('NumNeurons', conn,...
        mouse_list{i}, 'unshuffled', 'IMSE', 'max');
    [nPs{i}, mPs{i}, ePs{i}] = ...
        DecodingPlotGenerator.get_errors('NumNeurons', conn,...
        mouse_list{i}, 'shuffled', 'IMSE', 'max');
    [nPd{i}, mPd{i}, ePd{i}] = ...
        DecodingPlotGenerator.get_errors('NumNeurons', conn,...
        mouse_list{i}, 'diagonal', 'IMSE', 'max');
    
    %index_of_180 = find(nP{i} == 180,1);
    %norm_by = mP{i}(index_of_180);%REPLACE WITH LINEAR FIT
    %fit_res = createFit_infoSaturation(nPs{i}, mPs{i});
    %norm_by = fit_res.I_0;
    fit_res = fit(double(nPs{i}), mPs{i}, 'p1*x', 'StartPoint', 0.002);
    norm_by(i) = fit_res.p1;
    mPs_normed{i} = mPs{i} ./ norm_by(i);
    ePs_normed{i} = ePs{i} ./ norm_by(i);
    %fit_res = createFit_infoSaturation(double(nP{i}), mP{i});
    %norm_by(i) = fit_res.I_0;
    %fprintf('s I_0: %f\t us I_0: %f\n', norm_by_s(i), norm_by(i));
    mP_normed{i} = mP{i} ./ norm_by(i);
    eP_normed{i} = eP{i} ./ norm_by(i);
    mPd_normed{i} = mPd{i} ./ norm_by(i);
    ePd_normed{i} = ePd{i} ./ norm_by(i);
end
lookup_at_value = @(val, val_col, res_col) cell2mat(...
    cellfun(@(n,m) m(n == val), val_col, res_col,...
    'UniformOutput', false).');

m_at_n = @(n) mean(lookup_at_value(n, nP, mP_normed));
e_at_n = @(n) sqrt(var(lookup_at_value(n, nP, mP_normed)) +...
    mean(lookup_at_value(n, nP, eP_normed).^2));

m_at_n_s = @(n) mean(lookup_at_value(n, nPs, mPs_normed));
e_at_n_s = @(n) sqrt(var(lookup_at_value(n, nPs, mPs_normed)) +...
    mean(lookup_at_value(n, nPs, ePs_normed).^2));

m_at_n_d = @(n) mean(lookup_at_value(n, nPd, mPd_normed));
e_at_n_d = @(n) sqrt(var(lookup_at_value(n, nPd, mPd_normed)) +...
    mean(lookup_at_value(n, nPd, ePd_normed).^2));

figure; hold on;
nn = [1 (30:30:500)];
mm = arrayfun(m_at_n, nn);
mm_s = arrayfun(m_at_n_s, nn);
mm_d = arrayfun(m_at_n_d, nn);
ee = arrayfun(e_at_n, nn);
ee_s = arrayfun(e_at_n_s, nn);
ee_d = arrayfun(e_at_n_d, nn);
%errorbar(nn, mm, ee, 'b');
%errorbar(nn, mm_s, ee_s, 'r');
DecodingPlotGenerator.errors_plotter(nn,mm_s,ee_s, 'shuffled');
DecodingPlotGenerator.errors_plotter(nn,mm,ee, 'unshuffled');
xlabel 'Number of cells'
ylabel(sprintf('1/MSE in\nunits of cells'));
xlim([0 500]);
text(10, 350, 'Unshuffled', 'Color', 'blue');
text(10, 420, 'Shuffled', 'Color', 'red');
%text(10, 490, 'y = x', 'Color', 'black');
%axis equal;
l_ = refline(1,0); l_.Color = 'k';
xlim([0 500]); ylim([0 500]);
figure_format;
print_svg(name);

figure; hold on;
DecodingPlotGenerator.errors_plotter(nn, mm, ee, 'unshuffled');
DecodingPlotGenerator.errors_plotter(nn, mm_d, ee_d, 'diagonal');
xlabel 'Number of cells'
ylabel(sprintf('1/MSE in\nunits of cells'));
l_ = refline(1,0); l_.Color = 'k';
xlim([0 500]); ylim([0 200]);
text(10, 350/2.5, 'Full', 'Color', 'blue');
text(10, 420/2.5, 'Diagonal', 'Color', 'magenta');
%text(10, 490/2.5, 'y = x', 'Color', 'black');
figure_format; name = 'fulldiagonal_pooled_normed';
print_svg(name);
conn.close;
%
figure;
full_gain_m = cellfun(@(x,y)x-y, mP_normed, mPd_normed, 'UniformOutput', false);
full_gain_e = cellfun(@(x,y)sqrt(x.^2+y.^2), eP_normed, ePd_normed, 'UniformOutput', false);
m_at_n_gain = @(n) mean(lookup_at_value(n, nPd, full_gain_m));
e_at_n_gain = @(n) sqrt(var(lookup_at_value(n, nPd, full_gain_m)) +...
    mean(lookup_at_value(n, nPd, full_gain_e).^2));

DecodingPlotGenerator.errors_plotter(nn, arrayfun(m_at_n_gain, nn), arrayfun(e_at_n_gain, nn),...
    'diff');
xlabel 'Number of cells'
ylabel(sprintf('\\Delta1/MSE\nin units of cells'));
text(10, 100, 'Full - Diagonal', 'Color', 'black');
figure_format; name = 'fulldiagonal_normed_diff';
print_svg(name);